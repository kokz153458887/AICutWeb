# 语音服务接口文档

## 语音生成接口

### 基本信息

- **接口URL**: `/api/voice/generate`
- **请求方式**: POST
- **接口描述**: 将文本转换为语音


### 请求参数

| 参数名 | 类型 | 必填 | 默认值 | 取值范围 | 描述 |
|--------|------|------|---------|----------|------|
| voice_server | string | 是 | "youdao" | youdao, aliyun, tencent, volcano, cosyvoice | 语音服务类型 |
| text | string | 是 | "你好，这是一个测试" | - | 要转换的文本内容 |
| voice_name | string | 是 | "youxiaoxun" | - | 音色名称，每个服务支持的音色不同 |
| speed | float | 否 | 1.0 | -10.0 ~ 10.0 | 语速，1.0为正常语速，2.0为正常语速的2倍 |
| volume | float | 否 | 1.0 | -10.0 ~ 10.0 | 音量，1.0为正常音量，2.0为正常音量的2倍 |
| pitch | float | 否 | 0.0 | -10.0 ~ 10.0 | 音调，0为正常音调，-10.0为最低音调，10.0为最高音调 |
| emotion | string | 否 | null | neutral, happy, sad, angry | 情感（仅部分服务支持） |
| output_path | string | 否 | null | - | 输出目录路径，不需要填写 |

### 响应参数

| 参数名 | 类型 | 描述 |
|--------|------|------|
| audio_url | string | 生成的音频文件路径 |
| duration | float | 音频时长（秒） |

### 请求示例

```bash
curl -X 'POST' \
  'http://localhost:5127/api/voice/generate' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
    "voice_server": "youdao",
    "text": "你好，这是一个测试",
    "voice_name": "youxiaoxun",
    "speed": 1.0,
    "volume": 1.0,
    "pitch": 0.0
  }'
```

### 响应示例

```json
{
  "audio_url": "./output/user/youdao/test_audio_001.mp3",
  "duration": 2.5
}
```

### 错误码

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 参数验证失败 |
| 500 | 服务器内部错误 |

### 注意事项

1. 服务启动时会自动创建输出目录
2. 调试模式下（TTS_GENERATE_DEBUG=true）会检查是否存在相同文本的音频文件
3. 音频格式由各个语音服务的配置决定
4. 不同语音服务对参数范围的支持可能不同，服务内部会进行相应的转换：
   - 有道云服务：
     * speed: -10.0~10.0 -> 0.5~2.0
     * volume: -10.0~10.0 -> 0.5~5.0
   - 阿里云服务：
     * speed: -10.0~10.0 -> -500~500
     * volume: -10.0~10.0 -> 0~100
     * pitch: -10.0~10.0 -> -500~500

